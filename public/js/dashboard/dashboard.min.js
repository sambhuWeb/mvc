$(function(){
  $.get(
    'dashboard/xhrGetListings',
    function (res){
      //[ array of ojects
      //{"id":"1","text":"sambhu"},
      //{"id":"2","text":"raj"},
      //{"id":"3","text":"singh"},
      //{"id":"4","text":"samhu"}]
      var len = res.length;
      for (var i= 0; i < len; i++){
        $('#listInserts').append('<div>' + res[i].text + '&nbsp;<a class="del" rel="'+res[i].id+'" href="#">X</a></div>');
      }
      $('.del').live('click', function(){//live updates the
        var delItem = $(this);
        var id = $(this).attr('rel');
        $.post(
          'dashboard/xhrDeleteListing',
          {'id': id}, 
          function(){
            delItem.parent().remove();
          }, 'json'
        );
        return false;
      });           
    }, 'json'
  );
  
  $('#randomInsert').submit(function(){
    var url = $(this).attr('action');//	http://www.mvc.lcl/dashboard/xhrInsert
    var data = $(this).serialize();//serialize the content of form

    $.post(
      url,//file on server
      data, //param to be passed to a file
      function(res){//result [data] send by the server
        $('#listInserts').append('<div>' + res.text + '&nbsp;<a class="del" rel="'+res.id+'" href="#">X</a></div>');
      }, 'json' //need data in json format
    );    
    return false;//because we want form to be handled by js and not refresh the page
  });
  
});